<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.javaclassS9.dao.AdminDAO">

	<select id="getAllMemberList" resultType="com.spring.javaclassS9.vo.MemberVO">
		select *, timestampdiff(day, lastDate, now()) as deleteDiff from memberS order by startDate desc
		<if test="startIndexNo != 0"> limit #{startIndexNo},#{pageSize}</if>;
	</select>
	<select id="getMemberLevelList" resultType="com.spring.javaclassS9.vo.MemberVO">
		select *, timestampdiff(day, lastDate, now()) as deleteDiff from memberS
			where m_group=#{m_group} order by idx desc limit #{startIndexNo},#{pageSize};
	</select>
	<select id="getMemberSearchList" resultType="com.spring.javaclassS9.vo.MemberVO">
		select *, timestampdiff(day, lastDate, now()) as deleteDiff from memberS
			where ${part} like concat('%',#{searchString},'%') order by idx desc
			<if test="startIndexNo != 0"> limit #{startIndexNo},#{pageSize}</if>;
	</select>
	<select id="getJoinMemberCount" resultType="int">
		select count(*) from memberS where <![CDATA[datediff(startDate,now()) > -7]]>;
	</select>
	<select id="getProductEstimateCount" resultType="int">
		select count(*) from productSaleS where statement='QUOTE';
	</select>
	<select id="getNewConsultingCount" resultType="int">
		select count(*) from consultingS where completeDate is null;
	</select>
	<select id="getMemberDeleteReason" resultType="com.spring.javaclassS9.vo.DeleteMemberVO">
		select deleteReason,reasonDetail, count(*) as reasonCnt from deleteMember
			where deleteReason between 1 and 6 group by deleteReason;
	</select>
	<select id="getMemberJoinDate" resultType="com.spring.javaclassS9.vo.MemberVO">
		select date_format(startDate,'%Y-%m-%d') as joinDate, count(*) as joinCnt from memberS 
			group by date_format(startDate,'%Y-%m-%d');
	</select>
	<select id="reportBoardTotRecCnt" resultType="int">
		select count(*) from reportS;
	</select>
	<!-- 
	<select id="reportBoardTotRecCntSearch" resultType="int">
		select count(*) from reportS where ${search} like concat('%',#{searchString},'%');
	</select>
	-->
	<select id="getReportBoardList" resultType="com.spring.javaclassS9.vo.ReportVO">
		select r.*, datediff(r.rpDate, now()) as date_diff, 
			b.idx as fbIdx, b.title as fbTitle, b.content as fbContent, b.mid as fbMid, 
			q.idx as qtIdx, q.title as qtTitle, q.content as qtContent, q.mid as qtMid, 
			c.idx as rcIdx, c.title as rcTitle, c.content as rcContent, c.mid as rcMid 
			from reportS r 
			left join freeBoardS b on b.idx = r.boardIdx and r.board='freeBoard' 
			left join questionBoardS q on q.idx = r.boardIdx and r.board='questionBoard' 
			left join recruitBoardS c on c.idx = r.boardIdx and r.board='recruitBoard' 
			order by r.rpDate desc
			<if test="startIndexNo != 0"> limit #{startIndexNo},#{pageSize}</if>;
	</select>
	<select id="adminAsRequestTotRecCnt" resultType="int">
		select count(*) from asRequest;
	</select>
	<select id="adminAsRequestTotRecCntSearch" resultType="int">
		select count(*) from asRequest where ${search} like concat('%',#{searchString},'%');
	</select>
	<select id="consultingTotRecCnt" resultType="int">
		select count(*) from consultingS;
	</select>
	<select id="consultingTotRecCntSearch" resultType="int">
		select count(*) from consultingS where ${search} like concat('%',#{searchString},'%');
	</select>
	<select id="getConsultingList" resultType="com.spring.javaclassS9.vo.ConsultingVO">
		SELECT *, datediff(writeDate, now()) AS date_diff 
			FROM consultingS 
			<if test="search != ''"> WHERE ${search} LIKE CONCAT('%',#{searchString},'%') </if> 
			ORDER BY idx desc 
			<if test="startIndexNo != 0"> limit #{startIndexNo},#{pageSize}</if>;
	</select>
	<select id="getConsultingContent" resultType="com.spring.javaclassS9.vo.ConsultingVO">
		select * from consultingS where idx = #{idx};
	</select>
	
	
	<insert id="setMemberDeleteReason">
		insert into deleteMember values(default, #{vo.deleteReason}, #{vo.reasonDetail}, 
		<if test="vo.deleteReason!=6">""</if>
		<if test="vo.deleteReason==6">#{vo.etc}</if>
		);
	</insert>
	<insert id="setConsultingInput">
		insert into consultingS values(default, #{vo.part}, #{vo.name}, #{vo.email}, #{vo.phone}, 
			#{vo.title}, #{vo.content}, default, null, null);
	</insert>
	
	
	<update id="setMemberLevelUpdateOk">
		update memberS set level=2 where mid = #{mid};
	</update>
	<update id="setProductEstimateChange">
		update productSaleS set statement=#{statement} where idx = #{idx};
	</update>
	<update id="setConsultingAnswer">
		update consultingS set completeDate = now(), answer=#{answer} where idx=#{idx};
	</update>
	
	
	<delete id="setMemberDeleteAll">
		delete from memberS where mid = #{mid};
	</delete>
	<delete id="setEngineerDeleteAll">
		delete from engineerS where idx = #{idx};
	</delete>
	<delete id="setProductDeleteOk">
		delete from productS where idx = #{idx};
	</delete>
	<delete id="setReportFreeBoardDelete">
		delete from freeBoardS where idx = (select boardIdx from reportS where idx = #{idx});
	</delete>
	<delete id="setReportQuestionBoardDelete">
		delete from questionBaordS where idx = (select boardIdx from reportS where idx = #{idx});
	</delete>
	<delete id="setReportContentDelete">
		delete from reportS where idx = #{idx};
	</delete>
</mapper>